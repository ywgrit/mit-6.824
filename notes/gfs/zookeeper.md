## zookeeper

zookeeper是一个和raft很像的存储系统，但是raft是线性一致的，而zookeeper并不是线性一致的模型，特点为：

- 所有客户端的写请求是线性一致的
- 同一客户端的的读写请求是线性一致的



尽管zookeeper不是线性一致的，但是zookeeper是一个良好的编程模型。其中一个原因是，有一个弥补非严格线性一致的方法



### zookeeper实现计数器

读-更改-写这三步骤即为实现test-and-set原子服务，为了实现原子服务，关键在于利用版本号，让并发的读取和写入满足线性一致性



### zookeeper实现互斥锁

有两种获取锁的方式，分别为立即获取锁和按序获取锁

#### 立即获取锁

每个客户端需要获取锁时，检测锁文件是否存在，如果不存在就创建新的锁文件，即获得互斥锁。如果存在就等待现有的锁文件被删除

#### 按序获取锁

多个客户端都需要获取锁，按客户端请求锁的顺序，即先请求的客户端先获得互斥锁。只有在某个客户端之前的所有客户端都获得锁之后，这个客户端才能获得锁。
